# Redux 核心概念

action reducer store

## mvc

它是一个 UI 的解决方案，用于降低 UI，以及 UI 关联的数据的复杂度

**服务端的 MVC**
环境：

1. 服务端需要响应一个完整的 HTML
2. 该 HTML 中包含页面需要的数据
3. 浏览器仅承担渲染页面的作用

以上的这种方式称为**服务端渲染**即在服务端将完整的页面组装好，一起发送给客户端

服务端需要处理 UI 中用到的数据，并且将数据嵌入到页面中，最终生成一个完整的 HTML 响应页面

为了降低这个过程的复杂度，出现了 MVC 模式

**Controller**
根据不同的请求地址和方法对应不同的控制器，用于处理请求，组装这次请求需要的数据，形成数据模型
**Model** 需要用于 UI 渲染的数据模型
**View** 视图，用于将模型组装到界面中,发送给客户端

**前端 MVC 模式的困难**
React 解决了 数据->视图

1. 前端的 controller 要比服务端复杂很多，因为前端的 controller 处理的是用户的操作，而用户的操作场景是复杂的，而后端的 controller 只处理请求。
2. 对于那些组件化的框架(比如 vue,react,它们使用的是单向数据流，若需要共享数据，则必须要将数据提升到顶层组件，然后一层一层的传递是及其繁琐的)
   1. 虽然可以使用上下文来提供共享数据，但是对数据的操作难以监控，容易导致调试错误的困难，以及数据还原的困难，若数据较多还会导致上下文非常复杂。

## 前端需要一个独立的数据解决方案

**Flux**

Facebook 提出的数据解决方案，最大的历史意义，它引入了 action 的概念，
action 是一个普通的对象,根据操作生成一个 action，用于描述要干什么
store 表示数据仓库，用于存储共享数据，还可以根据不同的 action 更改仓库中的数据。

**Redux**
在 flux 的基础上，引入了 reducer 的概念
reducer：处理器，专门用于处理数据
store 将 action 传递给 reducer,reducer 处理后返回给 store，store 存储新数据

# Redux 中间件（增强 dispatch 函数后返回增强的 dispatch 函数）

中间件：类似于插件，可以不影响原本功能，并且不改动原本代码的基础上，对其功能进行增强，在 Redux 中，中间件主要增强 dispatch 函数

Redux 中间件书写：

- 中间件本身是一个函数，该函数接收一个 store 参数，表示创建的仓库,该仓库并非一个完整的仓库对象，仅包含 getState,dispatch(原始的 dispatch) 属性该函数运行的时间是在仓库创建之后运行
  - 由于创建仓库后需要自动运行设置的中间件函数，因此，需要在创建仓库时，告诉仓库有那些中间件
  - 需要调用 applyMiddleware 函数，将函数的返回结果作为 createStore 的第二或第三个参数
- 中间件函数必须返回一个 dispatch 创建函数

**内部原理，将原始的 dispatch 传给最后一个中间件，增强功能后，将增强功能的 dispatch 传给上一个中间件，一直到第一个中间件，然后传给 store,store 在调用的时候，先调用第一个中间件，然后第一个中间件参数是第二个中间件返回的 dispatch，最后调用到原始的 dispatch 函数**

- applyMiddleware 函数，用于记录有哪些中间件，它会返回一个函数
  - 该函数用于记录创建仓库的方法，调用该函数又返回一个函数，传入 reducer
